<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Video Enhancement POC</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>WebRTC Video Enhancement POC</h1>
            <p class="subtitle">Real compression artifacts → Local enhancement</p>
        </header>

        <div class="main-content">
            <!-- WebRTC Connection Status -->
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-dot" id="connectionDot"></span>
                    <span id="connectionStatus">Disconnected</span>
                </div>
                <div class="status-item">
                    <span>Codec:</span>
                    <span id="codecInfo">--</span>
                </div>
                <div class="status-item">
                    <span>Bitrate:</span>
                    <span id="bitrateInfo">--</span>
                </div>
                <div class="status-item">
                    <span>Packet Loss:</span>
                    <span id="packetLoss">--</span>
                </div>
            </div>

            <!-- Video Source & WebRTC Settings -->
            <div class="control-panel">
                <h3>WebRTC Settings</h3>
                <div class="source-controls">
                    <div class="source-group">
                        <label for="videoSource">Source:</label>
                        <select id="videoSource">
                            <option value="webcam" selected>Your Webcam</option>
                            <option value="sample1">Big Buck Bunny</option>
                            <option value="sample2">Elephants Dream</option>
                            <option value="sample3">Sintel</option>
                        </select>
                    </div>
                    <div class="source-group">
                        <label for="targetBitrate">Bitrate:</label>
                        <select id="targetBitrate">
                            <option value="2000">2 Mbps (Good)</option>
                            <option value="1000">1 Mbps (Medium)</option>
                            <option value="500" selected>500 Kbps (Poor)</option>
                            <option value="250">250 Kbps (Bad)</option>
                            <option value="100">100 Kbps (Very Bad)</option>
                        </select>
                    </div>
                    <div class="source-group">
                        <label for="videoCodec">Codec:</label>
                        <select id="videoCodec">
                            <option value="VP8">VP8</option>
                            <option value="VP9" selected>VP9</option>
                            <option value="H264">H.264</option>
                        </select>
                    </div>
                    <button id="startBtn" class="primary-btn">Start WebRTC</button>
                    <button id="stopBtn" class="secondary-btn" disabled>Stop</button>
                </div>
            </div>

            <!-- Side by Side Video Comparison -->
            <div class="video-comparison">
                <div class="video-panel original">
                    <div class="video-header">
                        <h3>After WebRTC (Compressed)</h3>
                        <span class="resolution-badge" id="originalRes">--</span>
                    </div>
                    <div class="video-wrapper">
                        <video id="receivedVideo" muted playsinline autoplay></video>
                        <div class="video-overlay" id="originalOverlay">
                            <span>Video after WebRTC encoding/decoding<br>(with compression artifacts)</span>
                        </div>
                    </div>
                </div>

                <div class="video-panel enhanced">
                    <div class="video-header">
                        <h3>Enhanced (Local Processing)</h3>
                        <span class="resolution-badge" id="enhancedRes">--</span>
                    </div>
                    <div class="video-wrapper">
                        <canvas id="enhancedCanvas"></canvas>
                        <div class="video-overlay" id="enhancedOverlay">
                            <span>Enhanced output</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Source Video (small preview) -->
            <div class="source-preview">
                <div class="preview-label">Source (before WebRTC):</div>
                <video id="sourceVideo" muted playsinline></video>
            </div>

            <!-- Enhancement Controls -->
            <div class="control-panel">
                <h3>Enhancement Settings</h3>
                <div class="enhancement-controls">
                    <div class="control-row">
                        <div class="control-group">
                            <label>
                                <input type="checkbox" id="enableEnhancement" checked>
                                Enable Enhancement
                            </label>
                        </div>
                        <div class="control-group">
                            <label for="enhancementMode">Mode:</label>
                            <select id="enhancementMode">
                                <option value="sharpen">Sharpen</option>
                                <option value="denoise" selected>Denoise (for compression)</option>
                                <option value="enhance">Auto Enhance</option>
                                <option value="hdr">HDR Effect</option>
                                <option value="superres">Super Resolution (2x)</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-row sliders">
                        <div class="control-group">
                            <label for="intensity">Intensity: <span id="intensityVal">50</span>%</label>
                            <input type="range" id="intensity" min="0" max="100" value="50">
                        </div>
                        <div class="control-group">
                            <label for="brightness">Brightness: <span id="brightnessVal">0</span></label>
                            <input type="range" id="brightness" min="-50" max="50" value="0">
                        </div>
                        <div class="control-group">
                            <label for="contrast">Contrast: <span id="contrastVal">0</span></label>
                            <input type="range" id="contrast" min="-50" max="50" value="0">
                        </div>
                        <div class="control-group">
                            <label for="saturation">Saturation: <span id="saturationVal">0</span></label>
                            <input type="range" id="saturation" min="-50" max="50" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Stats -->
            <div class="stats-panel">
                <div class="stat">
                    <span class="stat-label">Processing FPS</span>
                    <span class="stat-value" id="fps">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Frame Time</span>
                    <span class="stat-value" id="frameTime">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Received Res</span>
                    <span class="stat-value" id="inputRes">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Output Res</span>
                    <span class="stat-value" id="outputRes">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Backend</span>
                    <span class="stat-value" id="backend">--</span>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <strong>How it works:</strong> This POC creates a real WebRTC loopback connection.
                Video is captured → encoded (VP8/VP9/H264) → transmitted through WebRTC → decoded.
                The "After WebRTC" panel shows the video with real compression artifacts.
                The "Enhanced" panel shows the result of local enhancement applied to the degraded video.
                <br><br>
                <strong>Try lowering the bitrate</strong> to see more compression artifacts, then enable enhancement to see the improvement.
            </div>
        </div>

        <footer>
            <p>WebRTC Video Enhancement POC | Real Encoding/Decoding + TensorFlow.js Enhancement</p>
        </footer>
    </div>

    <script src="js/enhancer.js"></script>
    <script src="js/webrtc-loopback.js"></script>
</body>
</html>
